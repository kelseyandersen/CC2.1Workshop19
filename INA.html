<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>INApreliminary - Analysis of the role of individual nodes in sampling epidemic spread v6</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CC2.1 R Workshop</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Welcome</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Introduction to R
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="CC2.1_IntroToR.html">Introduction to R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Networks in R
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Describing_Networks.html">Networks in R</a>
    </li>
    <li>
      <a href="EpidemicNetworks.html">Epidemic Networks</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    RTB Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="seedHealth.html">seedHealth</a>
    </li>
    <li>
      <a href="INA.html">INA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Resources.html">Resources</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">INApreliminary - Analysis of the role of individual nodes in sampling epidemic spread v6</h1>

</div>


<p>K. A. Garrett, University of Florida</p>
<div id="impact-network-analysis" class="section level2">
<h2>Impact network analysis</h2>
<p>Impact network analysis (INA) is designed to address multiple aspects of linked socioeconomic networks (spread of ideas, money, influence, etc.) and biophysical networks (spread of new varieties, certified seed, pathogens, pests, etc.).</p>
<p>The functions introduced here are part of an R package under development, “INA”. INA is the analysis of how technologies affect regional outcomes, such as productivity or disease incidence, through their effects on linked socioeconomic and biophysical networks (Garrett 2018).</p>
<p>Garrett KA, 2018. Impact network analysis: evaluating the success of interventions. PeerJ Preprints 6, e27037v1 <a href="https://doi.org/10.7287/peerj.preprints.v1" class="uri">https://doi.org/10.7287/peerj.preprints.v1</a>.</p>
</div>
<div id="risk-based-surveillance-strategies-as-part-of-an-impact-network-analysis" class="section level2">
<h2>Risk-based surveillance strategies, as part of an impact network analysis</h2>
<p>The example given here addresses identifying the best locations in a network for sampling to quickly detect a spreading pathogen (or spreading new variety, for example). A node is better for sampling if the pathogen is likely to be detected at that node before the pathogen has spread very far through the network. For example, an isolated node would be a poor sampling choice because the pathogen could spread widely before it reaches the isolated node.</p>
<p>The functions for this analysis can also take into account information about where the pathogen is more likely to enter the network. For example, nodes with little information available through communication networks may be more likely to be vulnerable to being entry points for pathogens.</p>
</div>
<div id="getting-the-inapreliminary-package-from-github" class="section level1">
<h1>Getting the INApreliminary package from GitHub</h1>
<p>An updated version of INApreliminary will be available on GitHub soon, and a complete version with multiple types of scenario analyses will be available later this year.</p>
<p>The examples below include creation of the functions that will later be available as part of INApreliminary.</p>
<div id="a-simple-example" class="section level2">
<h2>A simple example</h2>
<p>Consider a simple adjacency matrix, which will be used to illustrate the functions.</p>
<pre class="r"><code>library(&#39;igraph&#39;)
Amat &lt;- matrix(c(1,0,0,0,1,1,0,0,0,1,1,0,1,1,1,1),nrow=4,ncol=4)
Amati &lt;- graph.adjacency(Amat)
plot(Amati)</code></pre>
<p><img src="INA_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>sAmat &lt;- Amat * 0.7 # each potential link has probability 0.7 of existing - this will sometimes be useful</code></pre>
</div>
<div id="illustration" class="section level2">
<h2>Illustration</h2>
<p>For a single selected starting node, the invdetf function yields a vector of the number of nodes invaded for each sampling node by the time invasion reaches (is detected at) that sampling node, and the time step of first invasion at the sampling node - for one simulation.</p>
<p>The following code creates the function invdetf.</p>
<pre class="r"><code>invdetf &lt;- function(adjmat, start.choice, stoch=F){

  ### for all three functions, need to add in the definitions for the input variables...
  
  dimL &lt;- dim(adjmat)[1] # number of rows of adjacency matrix
  t1 &lt;- matrix( 0 * 1:dimL, nrow=1)
  t1[,start.choice] &lt;- 1 # starting node labelled 1
  
  # if a stochastic model, generate the adjacency matrix for this simulation
    # if stochastic, assumes the adjacency matrix is made up of probabilities

  if(stoch){ # need to think about the temporal resolution of stochasticity...
    adjmat &lt;- (matrix(runif(dimL^2), ncol=dimL) &lt; adjmat)
  }

  # generate the infection status for each node at each time point until spread stops

  outmat &lt;- t1
  infcount.pre &lt;- 1
  infcount.post &lt;- -9 # perhaps improve structure

  while(sum(t1) &lt; dimL &amp; infcount.pre != infcount.post){
    infcount.pre &lt;- sum(t1) # perhaps change to infcount.pre &lt;- infcount.post
    t1 &lt;- as.numeric(t1 %*% adjmat &gt; 0)
    infcount.post &lt;- sum(t1)
    outmat &lt;- rbind(outmat,t1) # row i is the ith time point
  }

  # find the num infected for each single sampling node, 
     # assuming infected node stays infected...
    # consider whether to set diag...

  # find the number of nodes infected at each time
  inft &lt;- rowSums(outmat)

  # find the first time each node is invaded, and number of nodes infected at that time
  firstt &lt;- -99 + 0*1:dimL # first time each node is invaded
  numt &lt;- firstt # number of nodes infected at that time

  for (i in 1:dimL){ # col i is the ith sample node

    if (sum(outmat[,i] &gt; 0)){ # if node i ever gets infected
      firstt[i] &lt;- min(which(outmat[,i] &gt; 0)) # first time
      numt[i] &lt;- inft[firstt[i]] # how many nodes at that time
    }
    else {
      firstt[i] &lt;- Inf
      numt[i] &lt;- max(inft)
    }

  }

  # for each node, time first invaded and number of nodes infected at that time
  sampnode &lt;- cbind(firstt, numt)

  list(outmat=outmat, sampnode=sampnode)
}</code></pre>
<p>The output is two matrices. The first matrix gives the infection status for each node (column) at each time point (row) until there is no further spread. The second matrix gives, for each node (row), the time until infection (column 1) and the number of nodes infected when at that time (column 2).</p>
<pre class="r"><code>invdetf(adjmat=Amat, start.choice=2) # in this case, the second node was selected as the starting point</code></pre>
<pre><code>## $outmat
##    [,1] [,2] [,3] [,4]
##       0    1    0    0
## t1    0    1    1    1
## t1    0    1    1    1
## 
## $sampnode
##      firstt numt
## [1,]    Inf    3
## [2,]      1    1
## [3,]      2    3
## [4,]      2    3</code></pre>
<pre class="r"><code>invdetf(adjmat=sAmat, start.choice=2,stoch=T) # stochastic version</code></pre>
<pre><code>## $outmat
##    [,1] [,2] [,3] [,4]
##       0    1    0    0
## t1    0    0    1    1
## t1    0    0    1    1
## 
## $sampnode
##      firstt numt
## [1,]    Inf    2
## [2,]      1    1
## [3,]      2    2
## [4,]      2    2</code></pre>
<p>The function allstartf summarizes this analysis across all potential starting points. The following code creates allstartf.</p>
<pre class="r"><code>allstartf &lt;- function(adjmat2, stoch2=F){

  dimL &lt;- dim(adjmat2)[1]

  alloutmat &lt;- matrix(-99, ncol=dimL, nrow=dimL)

  for (i in 1:dimL) {
    alloutmat[i,] &lt;- invdetf(adjmat=adjmat2, start.choice=i, stoch=stoch2)$sampnode[,2]
  }

alloutmat
}</code></pre>
<p>The output is a matrix with entries being the number of nodes infected by the time an invasion is detected at each potential sampling node. Rows in this matrix are potential introduction nodes and columns are potential sampling nodes. For the stochastic case, the result is based on only one simulation (at this point in the analysis).</p>
<p>Note that the diagonal contains ones, because when a node is both the starting point and the sampling point, the epidemic will only have reached one node before detection.</p>
<pre class="r"><code>allstartf(adjmat2=Amat)</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    3    4    3
## [2,]    3    1    3    3
## [3,]    2    2    1    2
## [4,]    1    1    1    1</code></pre>
<pre class="r"><code>allstartf(adjmat2=sAmat, stoch2=T)</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    3    4    3
## [2,]    1    1    1    1
## [3,]    1    1    1    1
## [4,]    1    1    1    1</code></pre>
<p>The function multisimf performs the same analysis, for the specified number of simulations.</p>
<pre class="r"><code>multisimf &lt;- function(adjmat3, stoch3=F, nsim=1) {

  dimL &lt;- dim(adjmat3)[1]

  outarr &lt;- array(-99, c(dimL,dimL,nsim)) # all results
  meanarr &lt;- matrix(-99, ncol=dimL, nrow=dimL) # mean of results
  vararr &lt;- meanarr # variance of results

  for (i3 in 1:nsim){
    tempout &lt;- allstartf(adjmat2=adjmat3,stoch2=stoch3)
    outarr[,,i3] &lt;- tempout
  }

  for (i3 in 1:dimL) {
    for (i4 in 1:dimL) {
      meanarr[i3,i4] &lt;- mean(outarr[i3,i4,])
      vararr[i3,i4] &lt;- var(outarr[i3,i4,])
  } }
# consider potential use of apply to replace the second loop

  list(outarr=outarr, meanarr=meanarr, vararr=vararr)
}</code></pre>
<p>The first component of the output from multisimf is the response for each simulation - nsim outputs from allstartf (in this example, 10 simulations). The next component of the output is the mean across the simulations. The final component is the variance across simulations.</p>
<p>Because columns represent potential sampling nodes, the mean of a column (in the second component of the output) is the mean number of nodes invaded by the time the invasion would be detected at that node. The mean of the variance in a column (in the third component of the output) indicates how consistently the mean number of nodes would have been invaded.</p>
<p>(AN OPTION NOT TO SHOW ALL SIMULATION RESULTS WILL BE INCLUDED)</p>
<pre class="r"><code>multisimf(adjmat3=sAmat, stoch=T, nsim=10)</code></pre>
<pre><code>## $outarr
## , , 1
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    3    1    3    3
## [3,]    2    2    1    2
## [4,]    1    1    1    1
## 
## , , 2
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    4    4
## [2,]    1    1    1    1
## [3,]    1    1    1    1
## [4,]    1    1    1    1
## 
## , , 3
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    3    1    3    3
## [3,]    1    1    1    1
## [4,]    1    1    1    1
## 
## , , 4
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    2    2
## [2,]    2    1    2    2
## [3,]    1    1    1    1
## [4,]    1    1    1    1
## 
## , , 5
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    2    2
## [2,]    1    1    1    1
## [3,]    2    2    1    2
## [4,]    1    1    1    1
## 
## , , 6
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    2    1    2    2
## [3,]    1    1    1    1
## [4,]    1    1    1    1
## 
## , , 7
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    3    4    3
## [2,]    3    1    3    3
## [3,]    1    1    1    1
## [4,]    1    1    1    1
## 
## , , 8
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    3    4    3
## [2,]    3    1    3    3
## [3,]    2    2    1    2
## [4,]    1    1    1    1
## 
## , , 9
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    4    4
## [2,]    2    1    2    2
## [3,]    1    1    1    1
## [4,]    1    1    1    1
## 
## , , 10
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    2    2    2
## [2,]    3    1    3    3
## [3,]    2    2    1    2
## [4,]    1    1    1    1
## 
## 
## $meanarr
##      [,1] [,2] [,3] [,4]
## [1,]  1.0  1.9  2.5  2.3
## [2,]  2.3  1.0  2.3  2.3
## [3,]  1.4  1.4  1.0  1.4
## [4,]  1.0  1.0  1.0  1.0
## 
## $vararr
##           [,1]      [,2]      [,3]      [,4]
## [1,] 0.0000000 0.5444444 1.8333333 1.3444444
## [2,] 0.6777778 0.0000000 0.6777778 0.6777778
## [3,] 0.2666667 0.2666667 0.0000000 0.2666667
## [4,] 0.0000000 0.0000000 0.0000000 0.0000000</code></pre>
</div>
<div id="weighted-likelihood-of-a-node-being-an-entry-point-into-network" class="section level2">
<h2>Weighted likelihood of a node being an entry point into network</h2>
<p>The calculations of means up to this point have been based on the assumption that each node is equally likely to be the starting node. (Alternative functions, under preparation, do include the option for nodes to have different probabilities of invasive establishment - with suffix wt)</p>
<p>The function wtsimf uses output from multisimf to evaluate the mean number of nodes reached when invasion would be detected at each potential sampling node, where potential starting nodes may have different probabilities of functioning as starting nodes. For example, higher risk of being the starting node might result from a node’s role as a port, or weather conditions associated with a node.</p>
<pre class="r"><code>wtsimf &lt;- function(msf.out, adjmat5, wtvec, nodenam=NA) {

  dimL &lt;- dim(adjmat5)[1]

  matop &lt;- msf.out$meanarr
  wtarr &lt;- wtvec * matop

  # find failure rate for each sampling node
  sampfail &lt;- colSums(wtarr)
  tsampfail &lt;- data.frame(1:dimL, sampfail, nodenam)
  
  list(wtarr=wtarr, tsampfail=tsampfail)
}</code></pre>
<p>This gives the failure rate. Sometimes a more useful summary might be expressing this in terms of success rates, in the sense of the number of nodes that are not infected when the pathogen is detected by a sampling node.</p>
<p>Suppose the weights indicating the probability that each of four nodes is the introduction node are as follows.</p>
<pre class="r"><code>wtvec.ex &lt;- c(0.001,0.2,0.798,0.001) # weights indicating the relative likelihood that each of four nodes is the introduction node for an invasion 

msf.outex &lt;- multisimf(adjmat3=sAmat, stoch=T, nsim=10)

wtsimf(msf.out=msf.outex, adjmat5=sAmat, wtvec=wtvec.ex)</code></pre>
<pre><code>## $wtarr
##        [,1]   [,2]   [,3]   [,4]
## [1,] 0.0010 0.0023 0.0028 0.0023
## [2,] 0.3800 0.2000 0.3800 0.3800
## [3,] 1.0374 1.0374 0.7980 1.0374
## [4,] 0.0010 0.0010 0.0010 0.0010
## 
## $tsampfail
##   X1.dimL sampfail nodenam
## 1       1   1.4194      NA
## 2       2   1.2407      NA
## 3       3   1.1818      NA
## 4       4   1.4207      NA</code></pre>
<pre class="r"><code>wtsimf(msf.out=msf.outex, adjmat5=sAmat, wtvec=wtvec.ex, nodenam=c(&quot;KS&quot;,&quot;NE&quot;,&quot;ND&quot;,&quot;SD&quot;))</code></pre>
<pre><code>## $wtarr
##        [,1]   [,2]   [,3]   [,4]
## [1,] 0.0010 0.0023 0.0028 0.0023
## [2,] 0.3800 0.2000 0.3800 0.3800
## [3,] 1.0374 1.0374 0.7980 1.0374
## [4,] 0.0010 0.0010 0.0010 0.0010
## 
## $tsampfail
##   X1.dimL sampfail nodenam
## 1       1   1.4194      KS
## 2       2   1.2407      NE
## 3       3   1.1818      ND
## 4       4   1.4207      SD</code></pre>
<p>Using the weights based on the number of information sources, or the quality of information sources, is one way to integrate the socioeconomic network and the biophysical network, with an egocentric network focus. There are many other possibilities for linking the two networks, potentially drawing on more information about the network of information communication. An example of this analysis applied to potential spread of disease through a seed system is available in</p>
<p>Buddenhagen, C. E., J. F. Hernandez Nopsa, K. F. Andersen, J. Andrade-Piedra, G. A. Forbes, P. Kromann, S. Thomas-Sharma, P. Useche, and K. A. Garrett. 2017. Epidemic network analysis for mitigation of invasive pathogens in seed systems: Potato in Ecuador. Phytopathology 107:1209-1218.</p>
<p>Andersen KF, Buddenhagen CE, Rachkara P, Gibson R, Kalule S, Phillips D, Garrett KA, 2018. Modeling epidemics in seed systems and landscapes to guide management strategies: The case of sweetpotato in Northern Uganda. Phytopathology, <a href="https://doi.org/10.1094/PHYTO-03-18-0072-R" class="uri">https://doi.org/10.1094/PHYTO-03-18-0072-R</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
